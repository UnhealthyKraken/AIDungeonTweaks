/* AI Dungeon Tweaks - Styles */
html, body { margin: 0; padding: 0; }
#transition-opacity .ai-caps-effect { display: inline-block; }
/* Flash */
.ai-caps-flash { animation: aiFlash 0.8s linear infinite; }
@keyframes aiFlash { 0%, 50% { opacity: 1; } 51%, 100% { opacity: 0.35; } }
/* Strobe (slower and more visible) */
.ai-caps-strobe { animation: aiStrobe 0.9s ease-in-out infinite; }
@keyframes aiStrobe {
  0%, 100% { filter: brightness(2) contrast(1.2); opacity: 1; }
  50% { filter: brightness(0.6) contrast(1.0); opacity: 0.8; }
}
/* Breathe (gentle pulse of scale and opacity) */
.ai-caps-breathe {
  display: inline-block;
  animation: aiBreathe 2.2s ease-in-out infinite;
  transform-origin: 50% 50%;
}
@keyframes aiBreathe {
  0%, 100% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.06); opacity: 0.9; }
}
/* Rainbow (right-to-left sliding gradient) */
.ai-caps-rainbow {
  background: repeating-linear-gradient(270deg,
    #ff3b30 0%,
    #ff9500 16.66%,
    #ffcc00 33.33%,
    #34c759 50%,
    #5ac8fa 66.66%,
    #007aff 83.33%,
    #af52de 100%
  );
  background-size: 600% 100%;
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  animation: aiRainbowSlide 3s linear infinite;
  will-change: background-position;
}
@keyframes aiRainbowSlide {
  0% { background-position: 0% 50%; }
  100% { background-position: -600% 50%; }
}

/* Respect user reduced motion preference */
@media (prefers-reduced-motion: reduce) {
  .ai-caps-flash,
  .ai-caps-strobe,
  .ai-caps-breathe,
  .ai-caps-rainbow,
  .ai-caps-wave {
    animation: none !important;
  }
}

/* Wave (vertical bob + subtle scale) */
.ai-caps-wave {
  display: inline-block;
  animation: aiWave 1.4s ease-in-out infinite;
}
@keyframes aiWave {
  0%, 100% { transform: translateY(0) scale(1); }
  25% { transform: translateY(-3px) scale(1.03); }
  50% { transform: translateY(0) scale(1); }
  75% { transform: translateY(3px) scale(0.98); }
}
/* Popup UI enhancements (scoped) */
#popup-root {
    box-sizing: border-box;
    width: 480px;
    min-width: 480px;
    max-width: 480px;
    padding: 12px 14px;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    color: #e5e7eb;
    background: rgba(15, 23, 42, 0.7);
    backdrop-filter: blur(10px) saturate(1.1);
    overflow-x: hidden; /* prevent tiny horizontal scrollbar from fractional rounding */
}

/* Popup header */
.popup-title {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    text-align: center;
}
.popup-title img {
    width: 22px;
    height: 22px;
    border-radius: 4px;
    display: inline-block;
}

/* Tab Navigation */
.tab-navigation {
    position: relative;
    display: flex;
    margin: 16px 0 20px 0;
    background: rgba(17, 24, 39, 0.55);
    border-radius: 12px;
    padding: 4px;
    border: 1px solid rgba(148,163,184,0.25);
    box-shadow: 0 4px 12px rgba(0,0,0,0.25);
    overflow: hidden; /* clip indicator glow to avoid subtle horizontal scroll */
}

.tab-button {
    flex: 1;
    padding: 10px 16px;
    background: transparent;
    border: none;
    color: #94a3b8;
    font-weight: 500;
    font-size: 13px;
    cursor: pointer;
    border-radius: 8px;
    transition: all 0.2s ease;
    position: relative;
    z-index: 2;
}

.tab-button:hover {
    color: #e5e7eb;
    background: rgba(30, 41, 59, 0.3);
}

.tab-button.active {
    color: #1f2937;
    font-weight: 600;
}

.tab-indicator {
    position: absolute;
    top: 4px;
    left: 4px;
    height: calc(100% - 8px);
    background: linear-gradient(135deg, #fbbf24, #f59e0b);
    border-radius: 8px;
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 1;
    box-shadow: 0 2px 8px rgba(251, 191, 36, 0.3);
    /* exact third of inner width (container has 4px left/right padding = 8px total) */
    width: calc((100% - 8px) / 3);
}

.tab-indicator[data-active="1"] {
    transform: translateX(0);
}

.tab-indicator[data-active="2"] {
    transform: translateX(100%);
}

.tab-indicator[data-active="3"] {
    transform: translateX(200%);
}

/* Tab Content */
.tab-content {
    position: relative;
}

.tab-panel {
    display: none;
}

.tab-panel.active {
    display: block;
}
#popup-root .setting-group {
    margin: 12px 0 14px;
    border: 1px solid rgba(148,163,184,0.25);
    background: rgba(17, 24, 39, 0.55);
    border-radius: 12px;
    padding: 8px 12px 10px;
    box-shadow: 0 6px 16px rgba(0,0,0,0.35);
}
#popup-root .group-summary {
    list-style: none;
    display: flex;
    align-items: center;
    gap: 6px;
    font-weight: 600;
    cursor: pointer;
    padding: 4px 0;
    margin: 0;
    user-select: none;
    color: #f3f4f6;
}
#popup-root .group-summary::-webkit-details-marker { display: none; }
#popup-root .group-summary::before {
    content: '\25BC';
    font-size: 10px;
    transition: transform 0.15s ease;
}
#popup-root details:not([open]) > .group-summary::before {
    transform: rotate(-90deg);
}
#popup-root .setting-item {
    display: grid;
    grid-template-columns: 1fr auto auto;
    align-items: center;
    gap: 10px;
    padding: 8px 0;
    border-top: 1px solid rgba(31,41,55,0.7);
}
#popup-root .setting-item:first-of-type {
    border-top-color: transparent;
}
#popup-root .setting-item label:first-child {
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-right: 8px;
    color: #e5e7eb;
}
#popup-root .setting-item select {
    max-width: 200px;
    padding: 8px 10px;
    font-size: 13px;
    border: 1px solid rgba(148,163,184,0.35);
    border-radius: 10px;
    background: rgba(11, 18, 32, 0.8);
    color: #e5e7eb;
    transition: border-color .15s ease, box-shadow .15s ease, background .15s ease;
}
#popup-root .setting-item select:hover { border-color: rgba(148,163,184,0.6); }
#popup-root .setting-item select:focus { outline: none; border-color: #60a5fa; box-shadow: 0 0 0 2px rgba(96,165,250,0.3); }

/* Recent color swatches */
#popup-root .color-swatches {
    grid-column: 1 / -1;
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
    margin-top: 4px;
}
#popup-root .color-swatches { grid-row: 2; }
#popup-root .color-swatch {
    width: 18px;
    height: 18px;
    border-radius: 999px;
    border: 1px solid #374151;
    cursor: pointer;
    background-color: transparent;
    background-image: none !important;
    display: inline-block;
}

/* Per-control reset button */
#popup-root .reset-btn {
    width: 26px;
    height: 26px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    border: 1px solid rgba(148,163,184,0.35);
    background: rgba(30,41,59,0.5);
    color: #cbd5e1;
    cursor: pointer;
}
#popup-root .setting-item .reset-btn:not(.reset-btn--label) { grid-column: 3; grid-row: 1; justify-self: end; }
#popup-root .reset-btn.reset-btn--label { padding: 0 10px; width: auto; height: 28px; gap: 6px; font-size: 12px; }
#popup-root .reset-btn:hover { border-color: rgba(148,163,184,0.6); background: rgba(30,41,59,0.65); }
#popup-root .reset-btn:active { transform: translateY(1px); }
#popup-root .color-swatch:focus { outline: 2px solid #3b82f6; outline-offset: 2px; }
#popup-root .setting-item--keyword {
    grid-template-columns: 1fr auto auto auto auto;
}
#popup-root .setting-item--keyword .toggle-switch { justify-self: end; }
/* Explicit column placement for keyword row controls */
#popup-root .setting-item--keyword > label[data-word] { grid-column: 1; }
#popup-root .setting-item--keyword select { grid-column: 2; }
#popup-root .setting-item--keyword [data-swatch] { grid-column: 3; justify-self: start; }
#popup-root .setting-item--keyword .toggle-switch { grid-column: 4; }
#popup-root .setting-item--keyword [data-remove] { grid-column: 5; justify-self: end; }
/* Ensure keyword remove button is to the far right, overriding generic reset placement */
#popup-root .setting-item.setting-item--keyword .reset-btn[data-remove] { grid-column: 5 !important; justify-self: end; }
#popup-root #profilesActionsRow .profiles-actions {
    grid-column: 2 / 4; /* span the two control columns */
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
}
#popup-root #profilesActionsRow .profiles-actions .reset-btn {
    min-width: 110px; /* make buttons consistent */
}
#popup-root .toggle-switch {
    position: relative;
    display: inline-block;
    width: 44px;
    height: 22px;
}
#popup-root .toggle-switch input { opacity: 0; width: 0; height: 0; }
#popup-root .toggle-switch .slider {
    position: absolute;
    inset: 0;
    background-color: #374151;
    transition: .2s ease;
    border-radius: 999px;
}
#popup-root .toggle-switch .slider:before {
    content: '';
    position: absolute;
    height: 18px; width: 18px;
    left: 2px; top: 2px;
    background: #ffffff;
    border-radius: 50%;
    transition: .2s ease;
    box-shadow: 0 1px 2px rgba(0,0,0,0.35);
}
#popup-root .toggle-switch input:checked + .slider { background-color: #3b82f6; }
#popup-root .toggle-switch input:checked + .slider:before { transform: translateX(22px); }

/* Base formatting styles */
#transition-opacity em,
#transition-opacity strong,
#transition-opacity del,
#transition-opacity code,
#transition-opacity mark {
    color: inherit;
    font-size: inherit;
    line-height: inherit;
    letter-spacing: inherit;
    font-family: inherit;
    margin: 0 1px;
}

/* Italic text (*text* or _text_) */
#transition-opacity em.ai-italic {
    font-style: italic !important;
    opacity: 0.95;
}

/* Italic speech text (*"text") */
#transition-opacity em.ai-italic-speech {
    font-style: italic !important;
    opacity: 0.95;
    display: inline;
}

/* Ensure italic speech is always italic even with inline styles */
#transition-opacity em.ai-italic-speech[style*="color"] {
    font-style: italic !important;
}

/* Force italic styling for any element with ai-italic-speech class */
em.ai-italic-speech,
#transition-opacity em.ai-italic-speech,
#transition-opacity * em.ai-italic-speech {
    font-style: italic !important;
}

/* Bold style for internal monologue when enabled */
.ai-italic-speech-bold {
    font-weight: bold !important;
}

/* Bold text (**text** or __text__) */
#transition-opacity strong.ai-bold {
    font-weight: bold;
    opacity: 0.95;
}

/* Speech quotes ("text") */
#transition-opacity strong.ai-speech {
    font-weight: bold;
    opacity: 0.95;
}

/* Optional bold class when using <span> for non-bold speech */
.ai-speech-bold {
    font-weight: bold !important;
}

/* Strikethrough text (~~text~~) */
#transition-opacity del.ai-strikethrough {
    text-decoration: line-through;
    opacity: 0.8;
}

/* Inline code (`text`) */
#transition-opacity code.ai-inline-code {
    font-family: 'Courier New', monospace;
    background-color: rgba(0, 0, 0, 0.1);
    padding: 2px 4px;
    border-radius: 3px;
    font-size: 0.9em;
}

/* Highlighted text (^^text^^ or ==text==) */
#transition-opacity mark.ai-highlight {
    background-color: rgba(255, 255, 0, 0.3);
    padding: 1px 2px;
    border-radius: 2px;
}

/* Handle cases where the element might have specific styling */
#transition-opacity em.font_gameplay,
#transition-opacity strong.font_gameplay,
#transition-opacity del.font_gameplay,
#transition-opacity code.font_gameplay,
#transition-opacity mark.font_gameplay {
    /* Preserve the original font styling while adding formatting */
    font-style: inherit;
    font-weight: inherit;
    text-decoration: inherit;
    font-family: inherit;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    #transition-opacity em,
    #transition-opacity strong,
    #transition-opacity del,
    #transition-opacity code,
    #transition-opacity mark {
        /* Slightly reduce margins on mobile for better fit */
        margin: 0 0.5px;
    }
    
    #transition-opacity code.ai-inline-code {
        padding: 1px 3px;
        font-size: 0.85em;
    }
}

/* In-page settings panel (modal) mirroring popup layout/colors */
.aid-panel {
    position: fixed;
    top: 80px;
    right: 24px;
    width: 480px;
    max-height: 80vh;
    overflow: visible;
    display: flex;
    flex-direction: column;
    z-index: 2147483647;
    background: transparent;
    border: 0;
    border-radius: 12px; /* rounded modal edges */
    box-shadow: none;
}

/* Fullscreen overlay behind the settings panel */
.aid-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.35);
    z-index: 2147483646;
}

.aid-panel__header { display: none; }

.aid-panel__title {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    font-weight: 600;
    color: #e5e7eb;
}



.aid-panel__close {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 28px;
    height: 28px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    background: rgba(17,24,39,0.55);
    color: #e5e7eb;
    border: 1px solid rgba(148,163,184,0.25);
    border-radius: 8px;
    cursor: pointer;
    z-index: 4;
}
.aid-panel__close:hover { background: rgba(17,24,39,0.7); border-color: rgba(148,163,184,0.45); }

.aid-panel__body {
    overflow: hidden; /* clip inner iframe corners */
    padding: 0;
    max-height: 80vh;
    background: transparent;
    border-radius: 12px;
}

.aid-panel__iframe {
    display: block;
    width: 100%;
    height: 620px;
    border: 0;
    background: transparent;
    border-radius: 12px; /* rounded iframe so the UI corners match */
    /* remove default iframe margins so panel centers visually */
    margin: 0;
}


.aid-panel__empty {
    margin: 10px;
    font-size: 13px;
    opacity: .85;
}

/* Embedded overrides: force solid colors to match extension popup visuals */
html[data-embedded="1"] #popup-root {
    background: #535967 !important; /* exact solid container */
    backdrop-filter: none !important;
    /* Visually balance left/right border by nudging container 2px left */
    margin-left: -2px;
}
html[data-embedded="1"] #popup-root .setting-group {
    background: #2F3645 !important; /* exact solid color */
    border-color: #2F3645; /* avoid contrast halo */
    box-shadow: none; /* prevent lightening at edges */
}
html[data-embedded="1"] #popup-root .setting-item select {
    background: #2F3645 !important; /* align controls to panel */
    border-color: #40485a !important;
}

/* Inner subsections (e.g., Say, Do, Speech) inside each card */
html[data-embedded="1"] #popup-root .setting-group .setting-group {
    background: #1E2634 !important;
    border-color: #1E2634 !important;
    box-shadow: none !important;
}
html[data-embedded="1"] #popup-root .reset-btn {
    background: rgba(30,41,59,0.6);
}

/* Inline input styles from popup moved to CSS */
#popup-root #keywordInput {
    padding: 8px 10px;
    border-radius: 10px;
    border: 1px solid rgba(148,163,184,0.35);
    background: rgba(11, 18, 32, 0.8);
    color: #e5e7eb;
    width: 180px;
}

#popup-root #fontSizeValue,
#popup-root #lineHeightValue,
#popup-root #letterSpacingValue {
    opacity: .8;
}
